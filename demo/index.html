<!DOCTYPE html>
<head>
  <script>
    function loadAnalytics() {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.setAttribute("async", "true");
      script.setAttribute("src", "https://www.googletagmanager.com/gtag/js?id=UA-165890546-1");
      document.documentElement.firstChild.appendChild(script);
    }

    if (document.location.host == 'gcode-preview.web.app') {
      loadAnalytics();

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-165890546-1');
    }
  </script>
  <title>GCode Preview</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body >
  <div id="app">
    <div class="sidebar p-4"  >
      <h1 class="text-center mt-2 mb-4">GCode Preview  <a href="https://www.npmjs.com/package/gcode-preview">
        <img src="https://img.shields.io/npm/v/gcode-preview.svg?style=flat"/>
        </a>
      </h1>
      <div class="scroll-container">
        <div>
          <section class="text-center mb-4">
            <div class="is-inline-block">
              <img v-if="thumbnail" 
                class="is-block is-fullwidth" 
                alt="thumbnail generated by slicer" 
                :src="thumbnail" />
              <div class="file-info"><span>{{layerCount + ' layers'}}</span> / <span>{{fileSize}}</span></div>
            </div>
          </section>
          <section> 
            <div class="flex is-justify-content-center">
              <select id="settings-presets"

              class="is-size-6"
              v-model="selectedPreset">
                <option v-for="(preset, name) in presets" :value="name">{{preset.title}}</option>
              </select>
            </div>
          </section>
          
          <div class="bulma-tabs bulma-is-small">
            <ul>
              <li :class="{ 'bulma-is-active': activeTab == 'layers' }"><a @click="selectTab('layers')">Layers</a></li>
              <li :class="{ 'bulma-is-active': activeTab == 'travel' }"><a @click="selectTab('travel')">Travel</a></li>
              <li :class="{ 'bulma-is-active': activeTab == 'extrusion' }"><a @click="selectTab('extrusion')">Extrusion</a></li>
              <li :class="{ 'bulma-is-active': activeTab == 'build-volume' }"><a @click="selectTab('build-volume')">Build volume</a></li>
            </ul>
          </div>  
          <div class="panel" v-cloak v-show="activeTab == 'layers'">
            <section>
              <div class="controls">
                <label :class="{'has-text-grey' : settings.singleLayerMode}" >Start layer <output id="start-layer-value" >{{settings.startLayer}}</output></label>&nbsp;
                <input
                  type="range"
                  min="1"
                  :max="settings.maxLayer"
                  id="start-layer"
                  v-model="settings.startLayer"
                  :disabled="settings.singleLayerMode"
                />
              </div>
              <div class="controls">
                <label>End layer <output id="end-layer-value" >{{settings.endLayer}}</output></label>&nbsp;
                <!-- HACK: extra :value binding to ensure the value is set after the max is updated -->
                <input
                  v-model="settings.endLayer"
                  type="range"
                  min="1"
                  :max="settings.maxLayer"
                  id="end-layer"
                  :value="settings.endLayer"
                /> 
              </div>
              <div class="controls">
                <label for="single-layer-mode">Single layer mode</label>
                <input type="checkbox" id="single-layer-mode" v-model="settings.singleLayerMode" />
              </div>
            </section>
          </div>
          <div class="panel" v-cloak v-show="activeTab == 'travel'">
            <section>
              <div class="controls">
                <label for="travel">Render travel</label>
                <input type="checkbox" id="travel"  v-model="settings.renderTravel" />
              </div>
              <div class="controls">
                <label :class="{'has-text-grey' : !settings.renderTravel}" for="travel-color">Travel color</label>
                <input type="color" id="travel-color" v-model="settings.travelColor" :disabled="!settings.renderTravel" />
              </div>
            </section>
          </div>
          
          <div class="panel" v-cloak v-show="activeTab == 'extrusion'">
            <section class="mb-0">
              <div class="controls">
                <label for="extrusion">Render extrusion</label
                ><input type="checkbox" v-model="settings.renderExtrusion" />
              </div>
            </section>

            <div :class="{'has-text-grey': !settings.renderExtrusion}">
              
              <section>
                <div class="controls">
                  <label for="render-tubes">Render as tubes</label
                  ><input type="checkbox" v-model="settings.renderTubes" :disabled="!settings.renderExtrusion"/>
                </div>
                <div class="controls" v-show="!settings.renderTubes">
                  <label>Line width <output>{{settings.lineWidth}}</output></label>&nbsp;
                <input
                  type="range"
                  min="0.1"
                  step="0.1"
                  max="10"
                  v-model="settings.lineWidth"
                  :disabled="!settings.renderExtrusion"
                />
              </div>
              
              <div class="controls" v-show="settings.renderTubes">
                <label>Extrusion width <output>{{settings.extrusionWidth}}</output></label>&nbsp;
                <input
                  type="number"
                  min="0.05"
                  max="3.0"
                  step="0.05"
                  v-model="settings.extrusionWidth"
                  :disabled="!settings.renderExtrusion"
                />
              </div>
              </section>

              <section class="extrusion-colors">
                <div class="flex just-between"># of extrusion colors  <div class="controls">
                  <button @click="addColor">+</button>
                  <button @click="removeColor">-</button>
                </div></div>

                <div class="controls" v-for="color,index in settings.colors">
                  <label for="extrusion-color-t0">Extrusion color (T{{index}})</label>
                  <input type="color" v-model="settings.colors[index]" :key="index" :disabled="!settings.renderExtrusion" />
                </div>
                
              </section>
              <section>
                <div class="controls">
                  <label for="highlight">Highlight top layer</label>
                  <input type="checkbox" v-model="settings.highlightTopLayer" :disabled="!settings.renderExtrusion" />
                </div>
                <div class="controls">
                  <label :class="{'has-text-grey' : !settings.highlightTopLayer}" for="top-layer-color">Top layer color</label>
                  <input type="color" v-model="settings.topLayerColor"  :disabled="!settings.highlightTopLayer || !settings.renderExtrusion" />
                </div>
                <div class="controls">
                  <label for="last-segment-color">Highlight last segment</label>
                  <input type="checkbox" v-model="settings.highlightLastSegment" :disabled="!settings.renderExtrusion"/>
                </div>
                <div class="controls">
                  <label :class="{'has-text-grey' : !settings.highlightLastSegment}" for="last-segment-color">Last segment color</label>
                  <input type="color" id="last-segment-color" v-model="settings.lastSegmentColor" 
                  :disabled="!settings.highlightLastSegment || !settings.renderExtrusion" />
                </div>

              </section>
            </div>
          </div>
          <div class="panel" v-cloak v-show="activeTab == 'build-volume'">
            <section>
              <div  class="controls">
                <label for="drawBuildVolume">Render build volume</label>
                <input type="checkbox" v-model="settings.drawBuildVolume" />
              </div>
              <div :class="{'has-text-grey' : !settings.drawBuildVolume}">
                <div class="controls">
                  <label for="buildVolumeX">Build volume (x)&nbsp;</label>
                  <input type="number" v-model="settings.buildVolume.x" step=10 :disabled="!settings.drawBuildVolume" />
                </div>
                <div  class="controls">
                  <label for="buildVolumeY">Build volume (y)&nbsp;</label>
                  <input type="number" v-model="settings.buildVolume.y" step=10 :disabled="!settings.drawBuildVolume" />
                </div>
                <div  class="controls">
                  <label for="buildVolumeZ">Build volume (z)&nbsp;</label>
                  <input type="number" v-model="settings.buildVolume.z" step=10 :disabled="!settings.drawBuildVolume" />
                </div>
              </div>
              <div class="controls">
                <label for="background-color">Background color</label>
                <input type="color" v-model="settings.backgroundColor" />
              </div>
            </section>
          </div>
        </div>
      </div>
      <div>
        <footer>
          <div class="text-center has-text-grey-light mb-5"><label class="mr-2">dev mode</label><input v-model="enableDevMode" type="checkbox" /> </div>
          <div><a href="http://twitter.com/remcoder">@remcoder</a> ©2020 - 2024</div>

          <div>
            <a href="https://github.com/remcoder/gcode-preview">code</a>
            - <a href="/docs">API docs</a>
            - MIT license
          </div>
        </footer>
      </div>
    </div>
  <div class="wrapper">
    <canvas class="preview" :class="{ 'dragging': settings.dragging }" 
      
      @dragover.prevent="dragOver"
      @dragleave.prevent="dragLeave"
      @drop.prevent="drop"></canvas>
  </div>
  <div class="dnd">☝️ Drop a gcode file to view it</div>
  
  </div>
  <script type="importmap">
    {
        "imports": {
            "three": "./build/three/build/three.module.js",
            "gcode-preview": "./build/gcode-preview.es.js",
            "lil-gui": "./build/lil-gui/dist/lil-gui.esm.min.js",
            "vue": "./js/vue.esm-browser.js"
        }
    }
  </script>
  <script type="module" src="./js/app.js"></script>
</body>
